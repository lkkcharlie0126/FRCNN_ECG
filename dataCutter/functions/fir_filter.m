function output_signal = fir_filter(input_signal, Fs)
%median filter
t1=floor(0.25*Fs)+1-mod(floor(0.25*Fs),2);%filter
t2=floor(0.55*Fs)+1-mod(floor(0.55*Fs),2);
signal_mid=medfilt1(input_signal,t1); %for PAG
baseline=medfilt1(signal_mid,t2);
signal_filter = input_signal-baseline;

% Band-pass
if Fs==512
    n=39;
    b=[-0.000616,0.016078,0.006284,0.005279,0.00320,-0.000259,-0.004858,-0.010020,-0.0149280,-0.0185880,-0.01997700,-0.01817300,-0.0125050,-0.00267600,0.011137,0.0282510,0.047510,0.0673930,0.086179,0.10213900,0.1137440,0.1198530,0.1198530,0.1137440,0.10213900,0.08617900,0.06739300,0.047510,0.028251,0.0111370,-0.002676,-0.012505,-0.0181730,-0.019977000,-0.0185880,-0.0149280,-0.010020,-0.004858,-0.000259,0.003200,0.0052790,0.006284,0.016078,-0.000616];
elseif Fs == 360
    %     [n,fo,mo,w] = firpmord([20 40],[1 0],[0.01 0.03], fs);
    n=30;
    b = [0.0138129504273089,-0.00366780168918392,-0.0111366898477784,-0.0144825235485908,-0.00697130214355321,0.00991635873284378,0.0246308426988081,0.0224812913561175,-0.00227314297434888,-0.0374938010947101,-0.0559400152334680,-0.0305111141094054,0.0464234686697447,0.153090595750434,0.246061691124398,0.282902778320547,0.246061691124398,0.153090595750434,0.0464234686697447,-0.0305111141094054,-0.0559400152334680,-0.0374938010947101,-0.00227314297434888,0.0224812913561175,0.0246308426988081,0.00991635873284378,-0.00697130214355321,-0.0144825235485908,-0.0111366898477784,-0.00366780168918392,0.0138129504273089];
elseif Fs == 1000
    n=83;
    b = [0.00868172331743399,-0.00803811871344702,-0.00600233624382443,-0.00502597649042861,-0.00463228922310179,-0.00455458804118625,-0.00462399356699053,-0.00474938242938048,-0.00485486347930402,-0.00490651479356903,-0.00486490524204463,-0.00471240977578161,-0.00442466663983160,-0.00399604195680193,-0.00340390539100438,-0.00265251299331361,-0.00171981526123220,-0.000618338512388180,0.000666965901715073,0.00211641655098997,0.00374294477756289,0.00551481254907051,0.00745453468475556,0.00949943922692184,0.0116814235180279,0.0139488455752693,0.0162716451139855,0.0186655058018325,0.0210652888352865,0.0234479676103612,0.0257985137368614,0.0280893690474782,0.0302788422871913,0.0323412139595401,0.0342501470949721,0.0359823858103768,0.0375261335911735,0.0388415168765167,0.0399154787526940,0.0407286294447322,0.0412725953953363,0.0415459062762669,0.0415459062762669,0.0412725953953363,0.0407286294447322,0.0399154787526940,0.0388415168765167,0.0375261335911735,0.0359823858103768,0.0342501470949721,0.0323412139595401,0.0302788422871913,0.0280893690474782,0.0257985137368614,0.0234479676103612,0.0210652888352865,0.0186655058018325,0.0162716451139855,0.0139488455752693,0.0116814235180279,0.00949943922692184,0.00745453468475556,0.00551481254907051,0.00374294477756289,0.00211641655098997,0.000666965901715073,-0.000618338512388180,-0.00171981526123220,-0.00265251299331361,-0.00340390539100438,-0.00399604195680193,-0.00442466663983160,-0.00471240977578161,-0.00486490524204463,-0.00490651479356903,-0.00485486347930402,-0.00474938242938048,-0.00462399356699053,-0.00455458804118625,-0.00463228922310179,-0.00502597649042861,-0.00600233624382443,-0.00803811871344702,0.00868172331743399];
else
    %     [n,fo,mo,w] = firpmord([20 40],[1 0],[0.01 0.03], fs);
    [n,fo,mo,w] = firpmord([40 60],[1 0],[0.01 0.03], 360);
    b = firpm(n,fo,mo,w);
    %     fvtool(b,1)
end

if length(signal_filter)<=3*n
    output_signal=signal_filter(1:end);
else
    output_signal=[];
    output_signal(1,:) = filtfilt(b,1,signal_filter(1:end));
end
output_signal = output_signal';
end
